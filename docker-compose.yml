version: '3.8'

services:
  minecraft:
    image: itzg/minecraft-server:latest
    container_name: minecraft-server
    restart: unless-stopped
    ports:
      - "25565:25565"      # Java Edition TCP
      - "25565:25565/udp"  # Java Edition UDP
    environment:
      EULA: "TRUE"
      VERSION: "1.21.3"
      TYPE: "PURPUR"
      JVM_FLAGS: "-Xms4G -Xmx4G -XX:+UseG1GC"
      VIEW_DISTANCE: "8"
      SIMULATION_DISTANCE: "4"
      MAX_PLAYERS: "20"
    volumes:
      - minecraft-data:/data
      - ./server:/data
    tty: true
    stdin_open: true
    cap_add:
      - NET_ADMIN

  # GeyserMC standalone proxy for Bedrock support
  geyser:
    image: geysermc/geyserdiscordbot:latest
    container_name: geyser-mc
    restart: unless-stopped
    ports:
      - "19132:19132/udp"  # Bedrock Edition UDP
    environment:
      GEYSER_CONFIG: |
        bedrock:
          port: 19132
          motd: "JJ's Minecraft Server"
          max-players: 20
          clone-commands: true
        remote:
          address: minecraft
          port: 25565
          auth-type: online
        metrics:
          enabled: true
    depends_on:
      - minecraft

volumes:
  minecraft-data:

networks:
  default:
    name: minecraft-network
